# The DevOps HANDBOOK の読書とメモ

# イントロダクション

筆者は共同でこの本を記載しているが、全員に共通することは DevOps に関してみんなアハ体験をしていること。

「あっわかった」その正体にはっと気づくような体験のことらしい。

またイントロの中で DevOps によくある誤解が述べられている。

- DevOps は単なる自動化・もしくはインフラのコード化だ

↑ の認識は結構ある気がする。

実際のところは DevOps は IT 組織全体で共通の目標を達成するための文化や規範をも必要とする。

オートメーションは DevOps という文化を成すための一つの構成要素や手段に過ぎないのではないか。

## 序章

技術的負債とは「私たちの判断で引きおきされた問題が将来の選択肢を狭めていくこと」

IT がうまくいかないと組織全体がうまくいかず、ダメージがゆっくり現れても、急に現れても破壊は同じように起こる。

「恐怖で支配する文化」ではなく、高信頼マネジメントにより「リスクを追う人が評価される協力を尊ぶ文化を作る。」

問題を解決するためには問題を直視しなければならないのだ。

DevOps の実践をしている会社とそうでない会社では以下のような違いがあった

- コードの変更とデプロイ 30 倍
- コードと変更のデプロイのリードタイム 200 倍
- 本番デプロイ(成功率が 60 倍高い)
- サービス復元の時間(168 倍早い)

## 1 章

DevOps はトヨタ生産方式（リーン生産方式）を IT に応用したもの

- フロー
- フィードバック
- 継続的な学習と実験

継続的デリバリーはコードとインフラストラクチャを常にデプロイ可能な状態に保ちトランクにチェックインされたコードは全て本番環境に安全にデプロイできるようにする
という考え方

日々習慣的に業務の改善を行うという改善のカタを作り上げることが重要

IT バリューストリームとは

- ビジネス上の仮説を立案してから顧客に価値を送り届ける技術サービスを生み出すまでの間に必要なプロセス

↑ を図るための指標が２つ

- リードタイム
  - 顧客が要求をした時から要求が満たされるまでの間の時間
- プロセスタイム
  - 顧客の要求のための作業を開始した時から満たされるまでの間の時間

DevOps では開発者は自分の仕事に対するフィードバックをコンスタントに受け取り、他部門からの制約を受けずに素早くコードを実装、〜本番環境へのデプロイができる。

### DevOps の 3 つの道

- 開発 → 運用 → 顧客の左から右へのワークフローを高速にする
  - 仕事を可視化し、バッチサイズと作業のインターブルを削減し、品質を組み込み、下流のワークセンターに不良品を渡さない
  - 絶えず改善を続けていく
- バリューストームのあらゆるステージで素早くてコンスタントな右から左へのフィードバックフローを受け取ること
- 成功と失敗の両方から組織として学習し教訓をえていく生産的な高信頼マネジメントの企業文化を生み出すこと
  - チーム内の発見を組織全体の経験の蓄積とする

### 2 章

開発　 → 　運用　への作業を素早く、かつミスなく届けるにはカンバンによる管理が良い。

この時カンバンはできるだけバリューストリーム全体を対象としていて、作業完了が右端に達した時に限るようにすればよい。

![カンバンイメージ](./images/kanban.png)

- マルチタスクで仕事をしている時には単純なタスクでも作業効率が大きく下がる
- 看板で各段階において、WIP(仕掛かり)として良いカードの数を制限する
- バッチサイズを小さく（問題ごとを小さくして、確実に解消していく）
  - 作業を小分けにすることで作業ミスによる手戻りもすくなくなり、生産性が上がる
- 日常業務からムダを削減する
  - 組織の目標達成のために継続的に学習することによって日常業務から苦痛と重労働を取り除くこと
  - 結果に影響を及ぼさずに省略できる皇帝など
    - 部分的に完成した仕事（途中のドキュメントとか）
    - 余分な処理
    - 余分な機能
    - など

作業を可視化し、WIP を減らし、バッチサイズを縮小して作業の受け渡しの負荷を減らして、制約条件を継続的に見つけ出して評価し、日常業務から苦痛を取り除く

### 3 章

- IT に限らず複雑なシステムにおいてエラーは必然であり不可避なので、あらゆる障害を発見できるという自身の元、恐怖を感じずに仕事ができる安全なシステムを設計しなければならない
- パフォーマンスが高い工場であらゆるバリューストリームの中に作業が測定、モニタリングされていて、不良や大きな逸脱があればすぐに誰かが見つけて対処する
- 問題が発生した時に一丸となって解決し、下流に影響を与えない。この一丸というのが、プロセス全体を止めるようであるが、学習が可能になる。
  - 記憶が薄れたり、状況が変化したりすることによって極めて重要な情報が失われることを防ぐ
- 本番環境のインシデントであれ、バリューストリームの早い段階のエラーであれ、なんか問題を起こした時に非難されずに、むしろそうすることが推奨される文化を作ることが重要
- バリューストリームないの全ての人々が、日常業務の一部として自分の担当分野の問題を見つけて修正していく日つゆがある。
- 開発・運用の特定の部門に責任が追及されないように、QA や情報セキュリティチームの品質チェックを自動化する
  - また、開発者がテストをリクエストするのではなく、開発者がオンデマンドでテストを実行できるようにする

素早くフィードバックを返して学習する。
問題の発生時には組織が一丸となって問題解決にあたり、新しい知識・知恵を生み出して上流で品質を確保する。

### 4 章

第３の道は継続的な学習の文化を作り出すことに着目する。

個人がコンスタントに知識を生み出して、それをチームや組織の知識に転化していくための原則。

- 事故や問題が起きた時に対応を誤ると、人々の心に注意深さではなく恐怖を植え付け、注意深い組織ではなく官僚主義的な組織を作り上げてしまう
- インシデントが起きた時は必ず「非難なしのポストモーテム（事後検証）を実施すると良い」
  - 非難を取り除けば恐怖が取り除かれ、恐怖が取り除かれれば正直になれる。正直になれば予防ができるようになる

#### 日常業務の改善を制度化する

- 問題の根本的な解決を避け、日常的な予防策に頼っていると、問題と技術的負債が蓄積し、やることなすこと全てがその予防策にすがり大きな障害から逃げ回ることになる
  - 日常業務より大切なのは日常業務の改善だ
  - 逆に技術的負債の解消のために正式に時間をとって、リファクタ改善をすれば日常業務を改善できる

### 感想・メモ

DevOps の 3 つの道

- フロー
  - 開発フローの左から右へのフローを早くする
- フィードバック
  - ↑ と逆で右から左へのフィードバックを早くする
- 継続的な学習と実験

ここを大前提として捉えておく。

### すぐに使えそうと思ったテクニック

- カンバン管理で、各段階に配置できるチケット・カードの数を制限する
  - これによりマルチタスクを制限できる
  - また、作業の完成を妨げている問題も見えやすくなる
